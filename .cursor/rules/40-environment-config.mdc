---
globs: "**/.env*,**/*config*.py,**/*config*.ts"
---

# Environment Configuration

## Backend Configuration

Backend uses [backend/env.example](mdc:backend/env.example) as template. Copy to `.env`:

```bash
cd backend
cp env.example .env
```

### Required Environment Variables

```env
# Vault directory path
VAULT_PATH=/home/user/kbase-vault

# JWT secret key (generate with: openssl rand -hex 32)
SECRET_KEY=your-secret-key-here

# Application password
PASSWORD=your-password-here
```

### Optional Environment Variables

```env
# Token expiration (default: 10080 minutes = 7 days)
ACCESS_TOKEN_EXPIRE_MINUTES=10080

# Server configuration
HOST=0.0.0.0
PORT=8000
```

### Loading Configuration

Configuration is loaded in [backend/app/config.py](mdc:backend/app/config.py) using `pydantic-settings`:

```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    vault_path: str
    secret_key: str
    password: str
    access_token_expire_minutes: int = 10080
    
    class Config:
        env_file = ".env"
```

## Frontend Configuration

Frontend uses environment variables with `VITE_` prefix. See [frontend/.env.example](mdc:frontend/.env.example) if it exists.

### API URL Configuration

```env
# Development
VITE_API_URL=http://localhost:8000

# Production
VITE_API_URL=https://api.example.com
```

### Using Environment Variables

Access in TypeScript code:
```typescript
const apiUrl = import.meta.env.VITE_API_URL
```

## Configuration Validation

### Backend

Validate all required variables on startup:
```python
from app.config import settings

def validate_config():
    """Validate configuration on startup."""
    if not settings.vault_path:
        raise ValueError("VAULT_PATH is required")
    if not os.path.exists(settings.vault_path):
        raise ValueError("Vault path does not exist")
```

### Frontend

Use type-safe environment variables:
```typescript
interface ImportMetaEnv {
  readonly VITE_API_URL: string
}

const apiUrl: string = import.meta.env.VITE_API_URL
```

## Docker Configuration

For Docker deployment, see [compose.yaml](mdc:compose.yaml):
- Environment variables set in `environment:` section
- Volumes mounted for persistent data
- Secrets managed via environment or files

## Security Considerations

- **Never commit `.env` files** - Use `.env.example` as template
- **Never commit sensitive data** - Use secrets management
- **Use strong SECRET_KEY** - Generate with `openssl rand -hex 32`
- **Use strong PASSWORD** - Change from default
- **Rotate keys regularly** - Update SECRET_KEY periodically